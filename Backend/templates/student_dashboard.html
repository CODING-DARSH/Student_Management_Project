{% extends "base.html" %}
{% block title %}Student Dashboard{% endblock %}
{% block content %}

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body {
    background: radial-gradient(circle at top left, #111 0%, #0d0d0d 60%, #000 100%);
    color: #e5e5e5;
    font-family: 'Inter', sans-serif;
  }
  .glass {
    background: rgba(30, 30, 30, 0.6);
    backdrop-filter: blur(18px);
    border: 1px solid rgba(100, 100, 100, 0.2);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
  }
  .glow {
    transition: 0.3s ease;
  }
  .glow:hover {
    box-shadow: 0 0 10px rgba(140, 140, 255, 0.3);
    transform: translateY(-2px);
  }
</style>

<!-- Navbar -->
<nav class="flex justify-between items-center bg-[#0f0f0f] border-b border-[#2c2c2c] px-8 py-4 fixed w-full top-0 z-50 shadow-lg">
  <h1 class="text-2xl font-semibold tracking-wide text-white flex items-center gap-3">
    ğŸ“ Student Dashboard
  </h1>
  <form action="/logout" method="POST" onsubmit="return confirm('Logout?')" class="flex items-center">
    <button class="bg-[#1f1f1f] hover:bg-[#2d2d2d] text-white px-5 py-2 rounded-lg text-sm glow transition">Logout</button>
  </form>
</nav>

<!-- Page Container -->
<div class="pt-24 px-10 pb-16 grid grid-cols-1 lg:grid-cols-3 gap-10">

  <!-- Profile Card -->
  <section class="glass p-6 rounded-2xl glow">
    <div class="flex flex-col items-center text-center space-y-4">
      <img src="https://cdn-icons-png.flaticon.com/512/1077/1077012.png"
           class="w-24 h-24 rounded-full border border-gray-600 shadow-md">
      <div>
        <h2 class="text-xl font-semibold">{{ student[1] }}</h2>
        <p class="text-gray-400 text-sm">ID: {{ student[0] }}</p>
        <p class="text-gray-400 text-sm">Grade: {{ student[2] or 'Not Assigned' }}</p>
      </div>
      <p class="italic text-gray-500 text-sm">â€œLearning never exhausts the mind.â€</p>
    </div>
  </section>

  <!-- Enrolled Courses -->
  <section class="glass p-6 rounded-2xl lg:col-span-2 glow">
    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">ğŸ“š Enrolled Courses</h2>
    {% if courses %}
    <ul class="grid md:grid-cols-2 gap-4">
      {% for c in courses %}
      <li class="bg-[#1b1b1b] border border-[#333] p-4 rounded-lg flex justify-between items-center hover:bg-[#262626] transition">
        <span class="font-medium">{{ c }}</span>
        <span class="text-gray-500 text-sm">Active</span>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-gray-500 italic">No enrolled courses yet.</p>
    {% endif %}
  </section>

  <!-- Enroll Form -->
  <section class="glass p-6 rounded-2xl glow">
    <h2 class="text-xl font-semibold mb-4">ğŸ“ Enroll in a Course</h2>
    <form method="POST" action="/student/enroll" class="space-y-4">
      <input type="text" name="course_id" placeholder="Enter Course ID"
             class="w-full bg-[#1b1b1b] border border-[#333] text-white px-3 py-2 rounded-md focus:ring-2 focus:ring-gray-500"
             required>
      <button class="w-full bg-[#2a2a2a] hover:bg-[#3a3a3a] text-white py-2 rounded-md font-medium">Enroll</button>
    </form>
  </section>

  <!-- Assignments Section -->
  <section class="glass p-6 rounded-2xl col-span-2 glow">
    <h2 class="text-xl font-semibold mb-4">ğŸ“‚ Assignments</h2>
    {% if assignments %}
    <div class="overflow-x-auto">
      <table class="w-full text-left text-gray-300">
        <thead class="text-gray-400 border-b border-gray-700 text-sm uppercase">
          <tr>
            <th class="py-2">Title</th>
            <th class="py-2">Due</th>
            <th class="py-2">Submission</th>
            <th class="py-2">Marks</th>
          </tr>
        </thead>
        <tbody>
          {% for a in assignments %}
          <tr class="border-b border-[#222] hover:bg-[#181818] transition">
            <td class="py-3 font-medium">{{ a[1] }}</td>
            <td class="py-3 text-gray-400">{{ a[2] }}</td>
            <td class="py-3">
              {% if a[3] %}
              <div class="flex items-center gap-2">
                <a href="/{{ a[3] }}" class="text-blue-400 hover:text-blue-300 text-sm">ğŸ“ View</a>
                <form method="POST" action="/student/upload" enctype="multipart/form-data" class="flex items-center gap-2">
                  <input type="hidden" name="assignment_id" value="{{ a[0] }}">
                  <input type="file" name="file" class="text-gray-400 text-xs w-36">
                  <button type="submit" class="text-gray-300 hover:text-white text-sm">â†» Update</button>
                </form>
              </div>
              {% else %}
              <form method="POST" action="/student/upload" enctype="multipart/form-data" class="flex items-center gap-2">
                <input type="hidden" name="assignment_id" value="{{ a[0] }}">
                <input type="file" name="file" class="text-gray-400 text-xs w-36">
                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md text-sm">Submit</button>
              </form>
              {% endif %}
            </td>
            <td class="py-3">
              {% if a[4] %}
                <span class="text-green-400 font-medium">{{ a[4] }}</span>
              {% elif a[3] %}
                <span class="text-yellow-400 text-sm">Submitted</span>
              {% else %}
                <span class="text-gray-500 text-sm">Not submitted</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <p class="text-gray-500">No assignments yet.</p>
    {% endif %}
  </section>

  <!-- Performance Chart -->
  <section class="glass p-6 rounded-2xl col-span-2 glow">
    <h2 class="text-xl font-semibold mb-4">ğŸ“Š Performance Overview</h2>
    <canvas id="gradeChart" height="100"></canvas>
  </section>

  <!-- Course Averages -->
  <section class="glass p-6 rounded-2xl glow">
    <h2 class="text-xl font-semibold mb-4">ğŸ“ˆ Course Averages</h2>
    {% if chart_labels %}
    <ul class="space-y-3">
      {% for label, value in chart_labels|zip(chart_data) %}
      <li class="flex justify-between items-center bg-[#1b1b1b] p-3 rounded-md hover:bg-[#252525] transition">
        <span>{{ label }}</span>
        <span class="font-semibold text-blue-400">{{ value }}</span>
      </li>
      {% endfor %}
    </ul>
    {% else %}
      <p class="text-gray-500">No graded courses yet.</p>
    {% endif %}
  </section>

  <!-- Notifications -->
  <section class="glass p-6 rounded-2xl glow">
    <h2 class="text-xl font-semibold mb-4">ğŸ”” Notifications</h2>
    {% if notifications %}
      <div class="space-y-2 max-h-64 overflow-y-auto scrollbar-thin scrollbar-thumb-[#333]">
        {% for n in notifications %}
        <div class="bg-[#1b1b1b] border border-[#333] p-3 rounded-md">
          <p>{{ n[0] }}</p>
          <small class="text-gray-500">{{ n[1] }}</small>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-gray-500 italic">No new notifications.</p>
    {% endif %}
  </section>
</div>

<script>
const chartLabels = JSON.parse('{{ chart_labels | tojson | safe }}');
const chartData = JSON.parse('{{ chart_data | tojson | safe }}');

new Chart(document.getElementById('gradeChart'), {
  type: 'line',
  data: {
    labels: chartLabels,
    datasets: [{
      label: 'Marks',
      data: chartData,
      fill: true,
      borderColor: '#6366f1',
      backgroundColor: 'rgba(99,102,241,0.1)',
      tension: 0.4,
      borderWidth: 2,
      pointBackgroundColor: '#818cf8'
    }]
  },
  options: {
    plugins: { legend: { display: false } },
    scales: {
      y: { ticks: { color: '#ccc' }, grid: { color: '#2a2a2a' } },
      x: { ticks: { color: '#ccc' }, grid: { display: false } }
    }
  }
});
</script>

{% endblock %}
